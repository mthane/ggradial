---
title: "vignette-ggradial"
author: "Thorben Hebbelmann, Michael Thane, Marcel Schulte"
date: "03/01/2022"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette-ggradial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

The package 'ggradial' provides geoms for ‘ggplot2’ with radial bar chart and radial line chart extensions in order to visualize high-dimensional clusters and their evolution.

* radial_barchart_static: Creates a radial barchart which shows a cluster's average feature values.
* radial_barchart_post_treatment: Creates a radial barchart which shows a cluster's average feature values and allows a comparison between different points in time. 
* radial_line_chart: Creates a radial line chart which shows the average feature values for each cluster.


## Installation

The package is hosted on [GitHub] and can be installed via: 

```{r install-github, echo=TRUE, eval=FALSE}
devtools::install_github("https://github.com/mthane/ggradial",auth_token="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")
```

[GitHub]: https://github.com/mthane/ggradial

## Usage Examples

First we take a view over the parameters and their functions:

* df: The dataset as data frame which should be scaled and only contain the category values in a wide table form.
* group_names: Character vector with group names of features. The number of columns in df and the length of group_names must be equal. Group names will be displayed in the inner circle.
* inner_label: Label inside the inner circle, e.g. name of the chart (optional).
* color_inner_circle Color of the inner circle (optional).
* scale_rng Min and max values to be shown (optional).
* interactive Boolean to indicate whether the plot should be interactive or not (optional).
* tooltip_bars: String to choose which tooltip texts will be displayed for the bars (when interactive). Options to select from: average, sd (standard deviation), ci (confidence interval), all. Default is average (optional).
* tooltip_labels: Data frame to provide the tooltip texts for the labels (when interactive), needs to have a "label" and a "description" column. The description provides the tooltip text for the assigned label (optional).
* show_group_names: Boolean to indicate whether the group names should be shown inside the inner circle. Default is true (optional).

Given the parameters the package is used as in following example:

```{r usage-example, eval = FALSE}
library(ggradial)
library(tidyverse)
library(ggiraph)

#file_in <- load("heart-disease.names")


mock = create_mockdata(Nf=25,n_treatments = 2,ngroups = 5)
dfs = mock$dfs
grs = mock$grs
dfs
df = dfs[c(".id", ".phase", ".cluster", grs$feature[grs$.gr_id != 1])]

df <- df %>%
  mutate(.cluster = factor(.cluster)) %>%
  filter(.cluster == levels(.cluster)[2L])

data_cluster <- df %>% mutate(.cluster = fct_drop(as.factor(.cluster))) %>% select(-c(.cluster))

group_names = grs$.gr_name[grs$.gr_id != 1]
#

data_static = data_cluster %>%select(!c(".id",".phase"))
radial_barchart_static(data_static, group_names,interactive = F)

data_linechart = df%>%select(!c(".phase"))
radial_line_chart(data_linechart,group_names)

radial_barchart_post_treatment(data_cluster,group_names)
```


The barchart provides a graphical representation of a subpopulation. Since each feature was scaled (z-score normalized) before clustering, it is thus possible to show features with originally different scales in a combined visualization. Due to feature scaling, bars inclined to the outside represent feature averages above the overall population mean and bars inclined to the inside represent feature averages below the population mean. 
For example, if the bar or point of a feature is +1.0, it means that the average feature value is one standard deviation above the feature average of the whole population and a value of -1 indicates that the subpopulation average is 1 standard deviation smaller than the overall population average. 
Furthermore with the post treatment bar chart it is possible to compare a subpopulation over time. The color of the arrows and feature labels allows to illustrate the effect of a measurement.
Finally, the radial line chart depicts cluster averages for each feature and provides therefore a compact summary of one or all clusters.
